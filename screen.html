<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Screen</title>
<style>
  body {
    margin: 0;
    background: #1b212c;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    display: block;
    background: white;
    max-width: 100%;
    max-height: 100%;
  }
</style>
</head>
<body>
<canvas id="pdfCanvas"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
window.addEventListener("load", async () => {
    if (typeof pdfjsLib === "undefined") {
        alert("PDF.js failed to load!");
        return;
    }

    const canvas = document.getElementById("pdfCanvas");
    const ctx = canvas.getContext("2d");
    const time = 10; // seconds per page

    pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    async function fetchFreshPDF() {
        // Use fetch() manually with no-cache to really force a new copy
        const response = await fetch("prez.pdf", { cache: "no-store" });
        const arrayBuffer = await response.arrayBuffer();
        return await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    }

    async function startSlideshow() {
        let pdfDoc = await fetchFreshPDF();
        let pageNum = 1;
        let totalPages = pdfDoc.numPages;

        async function renderPage(num) {
            const page = await pdfDoc.getPage(num);
            const unscaledViewport = page.getViewport({ scale: 1 });
            const scale = Math.min(
                window.innerWidth / unscaledViewport.width,
                window.innerHeight / unscaledViewport.height
            );
            const viewport = page.getViewport({ scale });

            canvas.width = viewport.width;
            canvas.height = viewport.height;

            await page.render({ canvasContext: ctx, viewport }).promise;
        }

        async function nextPage() {
            await renderPage(pageNum);
            pageNum++;
            if (pageNum > totalPages) {
                // ðŸ”„ fetch a fresh copy of the PDF and start over
                startSlideshow();
            } else {
                setTimeout(nextPage, time * 1000);
            }
        }

        window.addEventListener("resize", () => {
            if (pageNum > 1 && pageNum <= totalPages) {
                renderPage(pageNum - 1);
            }
        });

        nextPage();
    }

    startSlideshow();
});
</script>
</body>
</html>
